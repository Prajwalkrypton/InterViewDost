<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Tavus Avatar Demo</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 0;
        padding: 2rem;
        background: #0f172a;
        color: #e5e7eb;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      h1 {
        margin-bottom: 0.5rem;
      }
      p {
        margin-top: 0;
        margin-bottom: 1rem;
        color: #9ca3af;
      }
      textarea {
        width: 100%;
        min-height: 120px;
        padding: 0.75rem;
        border-radius: 0.5rem;
        border: 1px solid #4b5563;
        background: #020617;
        color: #e5e7eb;
        resize: vertical;
      }
      button {
        margin-top: 0.75rem;
        padding: 0.6rem 1.2rem;
        border-radius: 9999px;
        border: none;
        background: linear-gradient(to right, #22c55e, #0ea5e9);
        color: #0b1120;
        font-weight: 600;
        cursor: pointer;
      }
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .status {
        margin-top: 0.5rem;
        font-size: 0.9rem;
        color: #a5b4fc;
      }
      video {
        margin-top: 1.5rem;
        width: 100%;
        max-height: 400px;
        background: #020617;
        border-radius: 0.75rem;
        border: 1px solid #4b5563;
      }
      .raw-response {
        margin-top: 1rem;
        padding: 0.75rem;
        border-radius: 0.5rem;
        background: #020617;
        border: 1px solid #4b5563;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.8rem;
        max-height: 200px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Tavus Avatar Demo</h1>
      <p>
        Type any text below and click
        <strong>Generate Avatar Video</strong> to call the Tavus API (via a small FastAPI
        backend) and preview lip-sync.
      </p>

      <label for="script">Script text</label>
      <textarea id="script" placeholder="Type what you want the avatar to say..."></textarea>

      <button id="generateBtn">Generate Avatar Video</button>
      <div class="status" id="status"></div>

      <video id="video" controls></video>

      <p class="status" id="conversationUrlDisplay"></p>

      <div class="raw-response" id="raw"></div>
    </div>

    <script>
      const btn = document.getElementById("generateBtn");
      const textarea = document.getElementById("script");
      const statusEl = document.getElementById("status");
      const videoEl = document.getElementById("video");
      const rawEl = document.getElementById("raw");
      const convoUrlEl = document.getElementById("conversationUrlDisplay");

      // Change this if your FastAPI server runs on a different host/port
      const API_BASE = "http://localhost:8000";

      btn.addEventListener("click", async () => {
        const text = textarea.value.trim();

        btn.disabled = true;
        statusEl.textContent = "Calling Tavus via FastAPI...";
        rawEl.textContent = "";
        convoUrlEl.textContent = "";

        try {
          const resp = await fetch(`${API_BASE}/generate`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ text }),
          });

          if (!resp.ok) {
            const errorText = await resp.text();
            statusEl.textContent = `Error: ${resp.status} ${resp.statusText}`;
            rawEl.textContent = errorText;
            btn.disabled = false;
            return;
          }

          const data = await resp.json();
          statusEl.textContent = "Received response from Tavus (Create Conversation).";
          rawEl.textContent = JSON.stringify(data.raw_response, null, 2);

          if (data.conversation_url) {
            convoUrlEl.innerHTML =
              "Conversation URL: <a href='" +
              data.conversation_url +
              "' target='_blank' rel='noopener noreferrer'>Open in new tab</a>";
          } else {
            statusEl.textContent +=
              " No conversation_url found; check raw response and your Tavus parameters.";
          }
        } catch (err) {
          console.error(err);
          statusEl.textContent = "Request failed: " + err;
        } finally {
          btn.disabled = false;
        }
      });
    </script>
  </body>
</html>
